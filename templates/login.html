<!DOCTYPE html>
<html lang="ru">

<head>
    <title>Smart House</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="stylesheet" href="/static/css/main.css" type="text/css" media="screen" charset="utf-8" />
    <link rel="shortcut icon" href="/static/img/favicon.png" type="image/png">
    <script type="text/javascript" src="static/js/api.js"></script>
</head>

<body>
    <div class="wrapper">
        <div class="content">
            <div class="main-background"></div>
            <div class="background-color bike-front-style">

                <form id="login_form">
                    <p class="login-name-block">Welcome!</p>
                    <fieldset>
                        <p><input type="text" name="username" required value="" pattern="[A-Za-z0-9]{5,}"
                                title="Five or more characters(A-Z,a-z,0-9)" placeholder="Username"></p>
                        <p><input type="password" name="password" required value="" placeholder="Password"></p>
                        <p><label class="error-label" id="error"></label></p>
                        <p class="login-button"><input type="submit" name="login" value="Login"></p>
                    </fieldset>
                </form>

                <script>
                    window.addEventListener("load", function () {
                        let form = document.getElementById("login_form");

                        form.addEventListener("submit", function (event) {
                            event.preventDefault();
                            var req = new XMLHttpRequest();
                            var creds = { "password": form.elements["password"].value, "username": form.elements["username"].value };
                            req.open("POST", "/api/v1/login");
                            req.onreadystatechange = function () {
                                if (req.readyState == 4 && req.status == 200) {
                                    window.location = "/";
                                } else {
                                    error = document.getElementById("error")
                                    error.innerHTML = "Credentials are wrong"
                                }
                            }
                            req.send(JSON.stringify(creds));
                        });
                    });
                </script>

                <footer>

                </footer>
            </div>
</body>

</html>